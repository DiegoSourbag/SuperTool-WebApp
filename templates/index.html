<!DOCTYPE html>
<html>
<head>
  <title>✂️ rmbg</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='theme.css') }}">

</head>
<body>
  {% include 'navbar.html' %}
  <div id="dropZone" class="drop-zone">
    <h1>rmbg</h1>
    <form id="uploadForm" action="/rmbg" method="post" enctype="multipart/form-data">
      <input id="fileInput" type="file" name="file" style="display: none;" />
      <div class="btn-container">
        <button type="button" class="btn-paste" id="pasteButton">Paste from Clipboard</button>
        <input type="submit" value="Remove Background" />
      </div>
    </form>
    <img id="imagePreview" class="image-preview" style="display: none;" />
  </div>

  <script>
    let dropZone = document.getElementById("dropZone");
    let fileInput = document.getElementById("fileInput");
    let uploadForm = document.getElementById("uploadForm");
    let imagePreview = document.getElementById("imagePreview");
    let pasteButton = document.getElementById("pasteButton");

    // Open file picker when clicking on the drop zone
    dropZone.addEventListener("click", function () {
      fileInput.click();
    });

    // Submit the form automatically when a file is selected
    fileInput.addEventListener("change", function () {
      if (fileInput.files.length > 0) {
        previewImage(fileInput.files[0]);
      }
    });

    // Drag and drop events
    dropZone.addEventListener("dragover", function (e) {
      e.preventDefault();
      this.classList.add("dragover");
    });

    dropZone.addEventListener("dragleave", function (e) {
      this.classList.remove("dragover");
    });

    dropZone.addEventListener("drop", function (e) {
      e.preventDefault();
      e.stopPropagation();
      this.classList.remove("dragover");

      let file = e.dataTransfer.files[0];
      if (file) {
        fileInput.files = e.dataTransfer.files;
        previewImage(file);
      }
    });

    // Paste Button functionality
    pasteButton.addEventListener("click", function () {
      navigator.clipboard.read().then(items => {
        for (let item of items) {
          if (item.types.includes("image/png") || item.types.includes("image/jpeg")) {
            item.getType("image/png").then(blob => {
              let file = new File([blob], "clipboard-image.png", { type: "image/png" });
              let dataTransfer = new DataTransfer();
              dataTransfer.items.add(file);
              fileInput.files = dataTransfer.files;
              previewImage(file);
            });
          } else {
            alert("Clipboard does not contain a valid image!");
          }
        }
      }).catch(err => {
        alert("Failed to access clipboard: " + err);
      });
    });

    // Function to preview the image
    function previewImage(file) {
      if (file.type.startsWith("image/")) {
        let reader = new FileReader();
        reader.onload = function (e) {
          imagePreview.src = e.target.result;
          imagePreview.style.display = "block";
        };
        reader.readAsDataURL(file);
      } else {
        alert("Please upload a valid image file.");
      }
    }
  </script>
</body>
</html>
